-- Create ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TeleportGui"
screenGui.Parent = game.CoreGui

-- Create TextButton function
local function createTextButton(name, position, text, parent)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Size = UDim2.new(0.1, 0, 0.1, 0)
    button.Position = position
    button.Text = text
    button.Parent = parent
    
    local uiCorner = Instance.new("UICorner")
    uiCorner.Parent = button
    
    return button
end

-- Create Sound function
local function createSound(parent, soundId)
    local sound = Instance.new("Sound")
    sound.SoundId = soundId
    sound.Parent = parent
    return sound
end

-- Create Buttons
local teleportButton = createTextButton("Teleport", UDim2.new(0.7, 0, 0.4, 0), "Teleport", screenGui)
local emoteButton = createTextButton("Emote", UDim2.new(0, 0, 0.3, 0), "Emote", screenGui)
local anim1Button = createTextButton("Anim1", UDim2.new(0, 0, 0.4, 0), "Anim 1", screenGui)
local anim2Button = createTextButton("Anim2", UDim2.new(0, 0, 0.52, 0), "Anim 2", screenGui)
local anim3Button = createTextButton("Anim3", UDim2.new(0, 0, 0.64, 0), "Anim 3", screenGui)

-- Create Toggle Button
local toggleButton = createTextButton("Toggle", UDim2.new(0, 0, 0.22, 0), "NPC", screenGui)

-- Create Sounds
local sounds = {
    ["Teleport"] = createSound(screenGui, "rbxassetid://405593386"),
    ["Emote"] = createSound(screenGui, "rbxassetid://12345678"),
    ["Anim1"] = createSound(screenGui, "rbxassetid://12345678"),
    ["Anim2"] = createSound(screenGui, "rbxassetid://12345678"),
    ["Anim3"] = createSound(screenGui, "rbxassetid://12345678")
}

-- Variable to keep track of the current playing sound
local currentSound = nil

-- Function to stop the currently playing sound
local function stopCurrentSound()
    if currentSound then
        currentSound:Stop()
        currentSound = nil
    end
end

-- Function to play a sound and stop any previously playing sound
local function playSound(soundName)
    stopCurrentSound()
    currentSound = sounds[soundName]
    if currentSound then
        currentSound:Play()
    end
end

-- Hide anim buttons initially
anim1Button.Visible = false
anim2Button.Visible = false
anim3Button.Visible = false

-- Animation IDs
local animationIds = {
    ["Teleport"] = "rbxassetid://15957361339",
    ["Anim1"] = "rbxassetid://17275798442",
    ["Anim2"] = "rbxassetid://17861841334",
    ["Anim3"] = "rbxassetid://17863041811"
}

-- Function to play animation and stop all others
local function playAnimation(animationId)
    local player = game.Players.LocalPlayer
    local character = player.Character
    if character and character:FindFirstChild("Humanoid") then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        
        -- Stop all currently playing animations
        for _, track in pairs(humanoid:GetPlayingAnimationTracks()) do
            track:Stop()
        end
        
        local animation = Instance.new("Animation")
        animation.AnimationId = animationId
        local animationTrack = humanoid:LoadAnimation(animation)
        animationTrack:Play()
        
        return animationTrack
    else
        print("Humanoid not found.")
        return nil
    end
end

-- Function to find a random player
local function teleportToRandomPlayer()
    local players = game.Players:GetPlayers()
    local otherPlayers = {}
    for _, p in pairs(players) do
        if p ~= game.Players.LocalPlayer then
            table.insert(otherPlayers, p)
        end
    end
    
    if #otherPlayers > 0 then
        local randomPlayer = otherPlayers[math.random(#otherPlayers)]
        game.Players.LocalPlayer.Character:SetPrimaryPartCFrame(randomPlayer.Character.HumanoidRootPart.CFrame)
    else
        print("No other players found.")
    end
end

-- Function to teleport based on the toggle state and play animation
local function teleportToTarget()
    local targetPosition

    if toggleButton.Text == "Player" then
        teleportToRandomPlayer()
    elseif toggleButton.Text == "NPC" then
        local npc = game:GetService("Workspace").Live:FindFirstChild("Weakest Dummy")
        if npc and npc:FindFirstChild("HumanoidRootPart") then
            targetPosition = npc.HumanoidRootPart.CFrame
            game.Players.LocalPlayer.Character:SetPrimaryPartCFrame(targetPosition)
        end
    end

    local animationTrack = playAnimation(animationIds["Teleport"])
    if animationTrack then
        playSound("Teleport")
        animationTrack.Stopped:Wait()
    end
end

-- Connect buttons to their functions
teleportButton.MouseButton1Click:Connect(function()
    teleportToTarget()
end)

emoteButton.MouseButton1Click:Connect(function()
    anim1Button.Visible = not anim1Button.Visible
    anim2Button.Visible = not anim2Button.Visible
    anim3Button.Visible = not anim3Button.Visible
    
    playSound("Emote")
end)

anim1Button.MouseButton1Click:Connect(function()
    playAnimation(animationIds["Anim1"])
    playSound("Anim1")
end)

anim2Button.MouseButton1Click:Connect(function()
    playAnimation(animationIds["Anim2"])
    playSound("Anim2")
end)

anim3Button.MouseButton1Click:Connect(function()
    playAnimation(animationIds["Anim3"])
    playSound("Anim3")
end)

-- Toggle Button functionality
toggleButton.MouseButton1Click:Connect(function()
    if toggleButton.Text == "NPC" then
        toggleButton.Text = "Player"
    else
        toggleButton.Text = "NPC"
    end
end)

-- Set button transparency
emoteButton.Transparency = 0.8
teleportButton.Transparency = 0.8
anim1Button.Transparency = 0.8
anim2Button.Transparency = 0.8
anim3Button.Transparency = 0.8
toggleButton.Transparency = 0.8
