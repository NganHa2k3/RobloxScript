-- LocalScript placed in StarterPlayerScripts

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()
local character = player.Character or player.CharacterAdded:Wait()

-- Function to create a projectile
local function createProjectile(startPosition, targetPosition)
    local projectile = Instance.new("Part")
    projectile.Shape = Enum.PartType.Ball
    projectile.Size = Vector3.new(1, 1, 1)
    projectile.Position = startPosition
    projectile.Anchored = false
    projectile.CanCollide = false
    projectile.BrickColor = BrickColor.new("Bright red")
    projectile.Parent = workspace

    local controlPoint1 = startPosition + (targetPosition - startPosition) * 0.5
    local controlPoint2 = startPosition + (targetPosition - startPosition) * 0.5
    controlPoint1 = controlPoint1 + Vector3.new(0, 5, 0)
    controlPoint2 = controlPoint2 - Vector3.new(0, 5, 0)

    local function moveProjectile()
        local time = 0
        local duration = 2
        
        while time < duration do
            time = time + RunService.Heartbeat:Wait()
            local t = time / duration
            local point = (1 - t) ^ 3 * startPosition +
                          3 * (1 - t) ^ 2 * t * controlPoint1 +
                          3 * (1 - t) * t ^ 2 * controlPoint2 +
                          t ^ 3 * targetPosition

            projectile.Position = point
        end
        
        projectile:Destroy()
    end

    -- Function to handle projectile touch
    local function onTouch(otherPart)
        local otherPlayer = Players:GetPlayerFromCharacter(otherPart.Parent)
        if otherPlayer and otherPlayer ~= player then
            local targetPosition = otherPlayer.Character.PrimaryPart.Position
            local startCFrame = character.HumanoidRootPart.CFrame
            local endCFrame = CFrame.new(targetPosition)
            
            -- Tween properties
            local tweenInfo = TweenInfo.new(
                (startCFrame.Position - targetPosition).Magnitude / 250, -- Duration
                Enum.EasingStyle.Linear
            )
            local tween = TweenService:Create(character.HumanoidRootPart, tweenInfo, {CFrame = endCFrame})
            
            tween:Play()
            tween.Completed:Connect(function()
                projectile:Destroy()
                print("Teleport Done")
            end)
        end
    end

    projectile.Touched:Connect(onTouch)
    moveProjectile()
end

-- Function to handle mouse click
local function onMouseClick()
    local targetPosition = mouse.Hit.Position
    local startPosition = character.HumanoidRootPart.Position
    createProjectile(startPosition, targetPosition)
end

-- Connect mouse click event to the function
mouse.Button1Down:Connect(onMouseClick)

-- Function to handle player death
local function onCharacterAdded(newCharacter)
    character = newCharacter
    local humanoid = character:WaitForChild("Humanoid")
    
    -- Disconnect the previous mouse click connection if it exists
    if mouse.Button1Down then
        mouse.Button1Down:Disconnect()
    end

    humanoid.Died:Connect(function()
        -- Clean up and stop the script when the player dies
        if mouse.Button1Down then
            mouse.Button1Down:Disconnect()
        end
    end)
end

player.CharacterAdded:Connect(onCharacterAdded)
if player.Character then
    onCharacterAdded(player.Character)
end
